---
title: "Day 1: Data Visualisation Fundamentals"
output: html_document
---

```{r setup, include=FALSE}
# This chunk of code sets up how the output should be displayed
# feel free to ignore this!
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Potentially useful libraries

```{r prelim}
library(dplyr)
library(ggplot2)
library(readxl)

df <- read.csv("../../data/Malaria_Dataset_DataViz.csv")

# Colourblind palette
palette <- c(
  "#0173b2", "#de8f05", "#029e73", "#d55e00",
  "#cc78bc", "#ca9161", "#fbafe4", "#949494", "#ece133",
  "#56b4e9"
)
```

# Exercise 1: Data wrangling

Time to have a first glance at the dataset!
Write a function that:
 1. Only selects the numeric columns that do not end with "_id"
 2. Creates a table for the remaining columns with the following summary statistics:
  * min, Q1, median, mean, Q3, max
  * the number of NaNs
  * the data type (e.g., ```numeric```)

There are hundreds of possibility for this exercise! We show here three solutions

```{r, exercise1, message = FALSE, warning = FALSE}
describe1 <- function(data) {
  # data: A data frame
  # return: Data frame with summary statistics for 'data'

  # Filter out non-numeric data and "id columns"
  # can also use summarise_if
  sub_data <- data %>%
    select_if(is.numeric) %>%
    select(-ends_with("id"))

  # Brute-force solution
  df_min <- sapply(sub_data, min)
  df_mean <- sapply(sub_data, mean)
  df_max <- sapply(sub_data, max)
  df_quarts <- sapply(sub_data, quantile, probs = c(0.25, 0.5, 0.75)) %>% t()
  types <- sapply(sub_data, class)
  num.na <- sapply(sub_data, function(x) sum(is.na(x)))
  nunique <- unlist(sub_data %>% summarise_all(n_distinct))

  my_summary <- data.frame(df_min, df_mean, df_quarts, df_max, types, num.na, nunique)

  my_summary
}

describe2 <- function(data) {
  # data: A data frame
  # return: Data frame with summary statistics for 'data'

  # Filter out non-numeric data and "id columns"
  # can also use summarise_if
  sub_data <- data %>%
    select_if(is.numeric) %>%
    select(-ends_with("id"))

  # Other solution using "reframe"
  get_summary <- function(x) {
    list(
      min = min(x, na.rm = TRUE),
      q1 = quantile(x, 0.25, na.rm = TRUE),
      q2 = quantile(x, 0.5, na.rm = TRUE),
      mean = mean(x, na.rm = TRUE),
      q3 = quantile(x, 0.75, na.rm = TRUE),
      max = max(x, na.rm = TRUE)
    )
  }

  my_summary <- as.data.frame(
    sub_data |>
      reframe(across(where(is.numeric), get_summary)) |>
      t()
  )

  rownames(my_summary) <- c("min", "Q1", "Q2", "Q3", "max")

  my_summary
}

describe3 <- function(data) {
  sub_data <- data %>%
    select_if(is.numeric) %>%
    select(-ends_with("id"))

  # Other solution using "summary"
  my_summary <- as.data.frame(
    do.call(
      rbind, lapply(
        sub_data, summary
      )
    )
  )
  my_summary$nunique <- c(sub_data %>% summarise_all(n_distinct))
  my_summary$type <- lapply(sub_data, class)
  my_summary$num.na <- lapply(sub_data, function(x) sum(is.na(x)))

  my_summary
}

describe3(df)
```

# Exercise 2: univariate plots

Something should feel off regarding the column ```mosquito_temperature_suitability```.

Let's plot a histogram to check the distribution. Use both ```hist``` and ```geom_histogram```.

What could have happened? Fix the data from ```mosquito_temperature_suitability``` in a new column called ```mts``` such that the summary looks like this:

```
  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  0.00   43.67   59.51   58.59   77.14   94.04
```


```{r, exercise_2, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 8}
# base R histogram
hist(df$mosquito_temperature_suitability)

# ggplot2 histogram
ggplot(df, aes(mosquito_temperature_suitability)) +
  geom_histogram()
# Note: use "plot_grid" from the ```cowplot``` package
#       to plot base R and ggplot2 plots on the same window

df$mts <- df$mosquito_temperature_suitability / 1000
```

# Exercise 3: customising our univariate plot

Let's customise our last plot (this time using the ```mts``` column)!
Incorporate the following elements:
  - A vertical, red, dashed, line for the median
  - Vertical, black, dashed lines for the first and third quartiles
  - Better data-to-ink-ratio: opt for a white background, dashed grid lines, and remove the top and right borders
  - Increase the font size of the x and y ticks to 11

```{r, exercise_3}
mts_quantiles <- quantile(df$mts, probs = c(0.25, 0.5, 0.75))

ggplot(df, aes(mts)) +
  geom_histogram(fill = palette[1]) +
  labs(x = "Mosquito temperature stability") +
  # choose a minimal theme (no grey background)
  theme_classic() +
  theme(
    # set grid lines
    panel.grid.major = element_line(color = "gray", linetype = "dashed"),
    # set font size of x axis
    axis.text.x = element_text(size = 11L),
    # set font size of y axis
    axis.text.y = element_text(size = 11L)
  ) +
  # add a vertical line
  geom_vline(
    # intercept = median
    xintercept = mts_quantiles,
    # dashed line
    linetype = "dashed",
    color = "red",
    linewidth = 1
  )
```